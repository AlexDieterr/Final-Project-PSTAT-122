---
title: 'Final Project'
subtitle: "PSTAT122: Design and Analysis of Experiments" 

author:
  - name: "Fall 2025"
   # affiliations:
    #  - name: "Fall 2025"
affiliation-title: "Quarter"
format: 
 pdf:
    code-fold: true
    code-line-numbers: true
    code-copy: true
    code-tools: true
    self-contained: true
    toc: false
    toc-location: left
    number-sections: true
    geometry: margin=.5in
    indent: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message =  FALSE)
knitr::opts_chunk$set(warning =  FALSE)
knitr::opts_chunk$set(error =  FALSE)

```

:::: callout
::: {style="text-align: center"}
[**STUDENT NAME**]{style="color: blue;"}
:::

-   Alex Dieter (A070X06)
-   Ayden Kelleher (7874209)
-   Darren Tran (A1H9J10)
-   Peyton Lynch (A09Y96)
::::

::: callout-caution
# Due Date

**Due Date:** Monday, December 8, 2025, 11:59 PM
:::

# Introduction

Reaction times are important because they offer a clear window into how efficiently the brain and body process information and respond to changing conditions. In everyday life, quick reaction times contribute to safety, whether it’s braking to avoid an accident, adjusting your balance to prevent a fall, or responding to unexpected changes in your environment. In sports and high pressure tasks, faster reaction times can be the difference between success and failure, making them central to training and evaluation. Ultimately, reaction times matter because they reflect how well we perceive, decide, and act in real time.

However, the factors that influence ones reaction times are not very well known. What we are looking to find are what influences someones reaction time. What we intend to discover are the things that influence someones reaction time with common factors, namely whether or not you are listening to music, whether or not the lights are on or off, and whether you are using your dominant or non dominant hand. We will figure out which of these factors truly influence reaction time, and if there is any interaction.

# Experimental Design

Our experiment will be a $2^3$ factorial experiment with blocks on what impacts reaction times, and how those factors interact. Our 3 factors will be the whether or not lights are on or off, whether or not you are listening to music, and whether or not you are using your dominant or non dominant hand. The way we will apply these treatments is by running our tests while the lights are on/off, whether or not the person being tested is listening to music, and have the person use their dominant or non dominant hand.

We are measuring reaction time, through the following website, \newline `https://humanbenchmark.com/tests/reactiontime`. The way this website works is the screen changes color and you press the mouse as fast as you can after the screen color changes, and it records the time it takes to click. For each click you get one recorded time, so for each set of factors, we will do 5 tests and then record the mean. We will conduct the whole test once, recording each individual reaction test as an experimental unit, so we have a better idea of the variance of the data. After some quick preliminary testing while choosing which website to use, we found that it takes less than 30 seconds to run through 5 experimental units, which means our testing should be quick, in accordance to the project guidelines.

All of our factors will be fixed, since each factor contains each of the possible factors in that category. There is not a population of factors we are drawing from. Lights can be on or off, you can be using your dominant or non-dominant hand, and the tests can be conducted while the person is and isn't listening to music.

First, we will randomly order each of the treatments using code snippet 1 (7.1). The way this code works is it takes a random sample without replacement, which effectively gives us a random ordering of the tests. We will do this for each person, who will each be a block.

The way our experiment will use replication is very simple. The website we are using to track our reaction times administers 5 tests and then returns the mean. Our experimental unit will be the time it takes for one individual click. This means each test we get 5 replications per factor. We will do these replications back to back.

Our blocks will be different people. Our group consists of 4 people, so we will each be a block. Thus for each combination of treatments and blocks, we get 5 replicates.

-   Sample size: Provide number of observations per condition. Guideline: 5–10 per treatment for CRD, 3–5 blocks for RCBD, total feasible within 1 hour.

# Data Collection

We collected all of our data on the same day, with each of us doing the experiment in our own rooms. Everyone used their own laptop and mouse, but we made sure the room was quiet before starting. To get used to the Human Benchmark test, we each did five practice clicks in a normal setting with no factors applied.

After the warm-up, we followed the randomized order from Snippet 1. For every combination of music on/off, lights on/off, and dominant/weak hand, we ran Human Benchmark five separate times. Each run gave us one reaction time in milliseconds, so we ended up with five observations for each treatment combination.

We didn’t run into any errors or bad trials, so we didn’t have to repeat anything. Once we finished all of the runs, we entered the reaction times into R using the data-entry function in the Appendix. Each row of the dataset represents one run, along with the subject, the factor levels, and the replicate number. This gave us a full dataset with 160 observations that we used for the exploratory plots and ANOVA.

# Analysis

-   **Hypothesis Testing**: Test your hypothesis with an appropriate statistical test (e.g., ANOVA).

-   **Tables, Figures, & Code**: Include key results (ANOVA table, post-test) and relevant `R` code excerpts where needed.

-   Use `R` to analyze the data.

# Conclusions

-   Summarize key findings.
-   Comment on limitations and possible improvements.

# References

https://humanbenchmark.com/tests/reactiontime

Kandethody M. Ramachandran, Chris P. Tsokos, Chapter 9 - Analysis of variance, Editor(s): Kandethody M. Ramachandran, Chris P. Tsokos, Mathematical Statistics with Applications in R (Third Edition), Academic Press, 2021, Pages 369-414, ISBN 9780128178157, https://doi.org/10.1016/B978-0-12-817815-7.00009-9.
(https://www.sciencedirect.com/science/article/pii/B9780128178157000099)


# Appendices

-   `R` code.

## Snippet 1

```{r}
set.seed(12032025)
comboOfFactors <- c('Quiet&Dark&DomHand', 'Music&Dark&DomHand',
                    'Quiet&Dark&WeakHand','Music&Dark&WeakHand',
                    'Quiet&Light&DomHand','Music&Light&DomHand',
                    'Quiet&Light&WeakHand','Music&Light&WeakHand')
Person1 <- sample(comboOfFactors, size = 8)
Person2 <- sample(comboOfFactors, size = 8)
Person3 <- sample(comboOfFactors, size = 8)
Person4 <- sample(comboOfFactors, size = 8)

cat('Alex will test in the following order\n', Person1[c(1,2,3,4)], '\n', Person1[c(5,6,7,8)],'\n')
cat('\nAyden will test in the following order\n', Person2[c(1,2,3,4)], '\n', Person2[c(5,6,7,8)],'\n')
cat('\nDarren will test in the following order\n', Person3[c(1,2,3,4)], '\n', Person3[c(5,6,7,8)],'\n')
cat('\nPeyton will test in the following order\n', Person4[c(1,2,3,4)], '\n', Person4[c(5,6,7,8)],'\n')

```

```{r}
library(dplyr)

subjects     <- c("Alex", "Ayden", "Darren", "Peyton")
music_levels <- c("quiet", "music")
lights_lvls  <- c("dark", "light")
hand_levels  <- c("dom", "weak")

# 3-factor 2x2x2 × 4 subjects × 5 reps
df <- expand.grid(
  subject = subjects,
  music   = music_levels,
  lights  = lights_lvls,
  hand    = hand_levels,
  rep     = 1:5          # 5 runs per combo
) %>%
  arrange(subject)

# column where you'll put the reaction times
df$time_ms <- NA_real_
```

```{r}
#This is the function so we can enter in all of our data easily
enter_times <- function(name, music, lights, hand, times) {
  df$time_ms[df$subject==name &
             df$music==music &
             df$lights==lights &
             df$hand==hand] <<- times
}

# Alex's Data
enter_times("Alex", "music", "light", "weak", c(265, 217, 219, 261, 260))
enter_times("Alex", "quiet", "dark",  "weak", c(250, 271, 259, 202, 216))
enter_times("Alex", "quiet", "light", "dom",  c(207, 206, 203, 126, 189))
enter_times("Alex", "music", "dark",  "weak", c(181, 236, 194, 215, 214))
enter_times("Alex", "music", "light", "dom",  c(197, 189, 97, 200, 181))
enter_times("Alex", "music", "dark",  "dom",  c(197, 147, 96, 194, 201))
enter_times("Alex", "quiet", "light", "weak", c(214, 183, 241, 87, 221))
enter_times("Alex", "quiet", "dark",  "dom",  c(212, 202, 203, 187, 159))

# Ayden's Data
enter_times("Ayden", "quiet", "dark",  "weak", c(223, 245, 235, 226, 236))
enter_times("Ayden", "music", "dark",  "weak", c(226, 233, 229, 235, 233))
enter_times("Ayden", "music", "light", "dom",  c(220, 231, 275, 226, 238))
enter_times("Ayden", "quiet", "light", "weak", c(252, 219, 218, 243, 235))
enter_times("Ayden", "music", "light", "weak", c(226, 255, 247, 228, 242))
enter_times("Ayden", "quiet", "light", "dom",  c(226, 338, 227, 196, 245))
enter_times("Ayden", "quiet", "dark",  "dom",  c(224, 232, 223, 230, 231))
enter_times("Ayden", "music", "dark",  "dom",  c(220, 241, 238, 257, 234))

# Darren's Data
enter_times("Darren", "quiet", "dark",  "weak", c(269, 264, 272, 274, 253))
enter_times("Darren", "music", "dark",  "weak", c(130, 290, 273, 289, 291))
enter_times("Darren", "music", "light", "dom",  c(247, 230, 118, 260, 232))
enter_times("Darren", "music", "light", "weak", c(228, 251, 270, 261, 275))
enter_times("Darren", "quiet", "light", "weak", c(290, 268, 260, 245, 271))
enter_times("Darren", "quiet", "dark",  "dom",  c(267, 265, 248, 231, 259))
enter_times("Darren", "music", "dark",  "dom",  c(271, 293, 307, 260, 275))
enter_times("Darren", "quiet", "light", "dom",  c(223, 215, 221, 229, 253))

# Peyton's Data
enter_times("Peyton", "music", "light", "weak", c(272, 265, 279, 236, 312))
enter_times("Peyton", "music", "light", "dom",  c(287, 243, 265, 229, 259))
enter_times("Peyton", "quiet", "dark",  "weak", c(222, 329, 233, 289, 278))
enter_times("Peyton", "quiet", "light", "dom",  c(228, 249, 295, 264, 232))
enter_times("Peyton", "music", "dark",  "dom",  c(252, 229, 243, 250, 239))
enter_times("Peyton", "quiet", "dark",  "dom",  c(223, 226, 238, 218, 217))
enter_times("Peyton", "music", "dark",  "weak", c(228, 243, 291, 220, 312))
enter_times("Peyton", "quiet", "light", "weak", c(260, 261, 275, 249, 258))

```

After collecting all of the reaction time measurements and entering them into R, we summarized the data by computing the mean and standard deviation for each of the eight treatment combinations (Music × Lights × Hand). This gives a quick overview of how reaction times behaved across the different conditions. The table below shows the average reaction time (in milliseconds) and the variability across the five replicates for each treatment:

```{r}
library(dplyr)
library(knitr)

summary_table <- df %>%
  dplyr::group_by(music, lights, hand) %>%
  dplyr::summarise(
    mean_time = mean(time_ms),
    sd_time   = sd(time_ms)
  )

kable(summary_table,
      col.names = c("Music", "Lights", "Hand", "Mean Time (ms)", "Std Dev (ms)"),
      digits = 4,                            
      caption = "Summary of Reaction Times by Treatment Group",
      align = 'c')
```

Overall, reaction times varied quite a bit across conditions. In general, the weak hand tended to be slower than the dominant hand in most settings, which matches what we expected. Music and lighting also seemed to influence the results, but the direction of the effect wasn’t immediately clear from the raw means alone. We use these summaries mainly to get a sense of the patterns in the data before moving on to the formal ANOVA in the analysis section.

```{r}
library(ggplot2)

# Boxplot by Hand
ggplot(df, aes(x = hand, y = time_ms)) +
  geom_boxplot() +
  labs(title = "Reaction Time by Hand",
       x = "Hand Used",
       y = "Reaction Time (ms)")

# Boxplot by Music
ggplot(df, aes(x = music, y = time_ms)) +
  geom_boxplot() +
  labs(title = "Reaction Time by Music Condition",
       x = "Music",
       y = "Reaction Time (ms)")

# Boxplot by Lights
ggplot(df, aes(x = lights, y = time_ms)) +
  geom_boxplot() +
  labs(title = "Reaction Time by Lighting Condition",
       x = "Lights",
       y = "Reaction Time (ms)")

# Interaction Plot: Hand × Music
ggplot(df, aes(x = hand, y = time_ms, color = music, group = music)) +
  stat_summary(fun = mean, geom = "line") +
  stat_summary(fun = mean, geom = "point") +
  labs(title = "Interaction Plot: Hand × Music")

# Interaction Plot: Hand × Lights
ggplot(df, aes(x = hand, y = time_ms, color = lights, group = lights)) +
  stat_summary(fun = mean, geom = "line") +
  stat_summary(fun = mean, geom = "point") +
  labs(title = "Interaction Plot: Hand × Lights")

```

## Exploratory Data

To get a first look at our data, we made several boxplots for each factor and a set of interaction plots. The boxplot for hand (dominant vs. weak) showed the clearest difference. The weak hand had noticeably slower reaction times on average, and the spread was larger. This matched what we expected, since most people are less coordinated with their non-dominant hand.

For the music factor, the boxplots for “quiet” and “music” looked fairly similar overall. The medians were close, and both conditions had a few outliers. There might still be a small effect, but it wasn’t obvious just from the boxplots. The lighting factor (dark vs. light) showed a similar pattern. There were slight differences between the medians, but nothing significant.

We also made interaction plots to check whether the factors influenced each other. The hand × music plot showed two lines that were almost parallel, meaning music probably doesn’t change the effect of hand very much. The hand × lights plot looked similar, with only small differences between the light and dark conditions. All of the lines went up from dominant to weak hand, which lines up with the boxplots.

Overall, the exploratory graphs suggested that the hand factor has the strongest effect, while music and lighting might have smaller or weaker effects. The interaction plots didn’t show any major crossings, so any interactions are likely to be small. These patterns helped us get a feel for the data before running the formal ANOVA.

## Analysis

Now that we have a basic idea of what our data looks like, we can run an ANOVA test to see which factors have a significant effect on the response variable.

```{r}
anova_model <- aov(time_ms ~ hand*lights*music+subject, data=df)
summary(anova_model)

```

Recall the assumptions of the ANOVA test, that the trials are independent, that the residuals are normally distributed, and that the residuals have equal variance.

Our experimental design should ensure that the trials were independent. To double check, we will plot the residuals in time order, to see if there is a strong correlation between residuals. A tendency to have runs of positive nad negative residuals indicates positive correlation. 

```{r}
df_ordered <- df %>%
      mutate(hand = factor(hand, levels = c("dom", "weak"))) %>% # Specify desired order
      arrange(hand) %>%
      mutate(music = factor(music, levels = c('quiet', 'music'))) %>%
      arrange(music) %>%
      mutate(lights = factor(lights, levels = c('dark', 'light'))) %>%
      arrange(lights) %>%
      mutate(subject = factor(subject, levels = c('Alex', 'Ayden', 'Darren', 'Peyton'))) %>%
      arrange(subject)
  
#df_ordered
ordered_model <- aov(time_ms ~ hand*lights*music+subject, data=df_ordered)

plot(ordered_model$residuals)

```
After plotting the ordered residuals, we can see that there does not appear to be strong correlation between subsequent residuals, thus we can confirm our trials are independent. 

```{r}
library(ggpubr)
library(knitr)

anova_resid <- residuals(anova_model)
ggqqplot(anova_resid, title = "Q-Q Plot of Residuals", ylab = "Sample Quantiles")
```

To check the assumption of normality for the ANOVA model we have, we will use the Q-Q plot of the residuals, which allows us to see if the residuals are distributed normally visually. From the Q-Q plot it is seen that the points follow the line closely and remain the 95% confidence band. We have some outliers in our tails, with larger than expected residuals. However, the normality assumption is robust for the fixed effect anova test, which means moderate departures from normality are of little concern. Thus we can say our residuals are normally distributed or close enough to be of little concern. 

```{r}
plot(anova_model$residuals ~ hand, data=df)
plot(anova_model$residuals ~ lights, data=df)
plot(anova_model$residuals ~ music, data=df)
plot(anova_model$residuals ~ subject, data=df)
```

Our last assumption to check is equal variance, or homoscedasticity. To test it, we create a box plot of residuals for each factor Looking at the boxplot, we can see that the variances for each main effect are about equal. However, the variance does seem to depend on the blocks. To verify this, we will use the bartlett test
```{r}
subject_variance <- bartlett.test(anova_model$residuals ~ subject, data=df)
cat( 'The p-value that all subjects have the same variance is',
  subject_variance$p.value
)
sd_df <- data.frame(
  subject = c('Alex','Ayden','Darren','Peyton'),
  sample_variance = c(
    var(anova_model$residuals[df$subject=='Alex']),
    var(anova_model$residuals[df$subject=='Ayden']),
    var(anova_model$residuals[df$subject=='Darren']),
    var(anova_model$residuals[df$subject=='Peyton'])
  )
  
)

kable(
  sd_df,
  digits=4,
  row.names=F
)

```
We can see that the p-value for the test between different subjects is 0.008, which is significant for $\alpha=.05$. Thus we can conclude that the variance is different for different subjects. However,  we have equal sample sizes for each block and we have similar sized variances, where the largest is less than double than the smallest. According to chapter 9.3.2 of Ramachandran and Tsokos, "If the sizes of all the samples are equal, ANOVA is mostly robust for violation of homogeneity of the variances. A rule of thumb used for robustness for this condition is that the ratio of sample variance of the largest sample variance $s^2$ to the smallest sample variance $s^2$ should be no more than 3:1". We can see that our sample variances are under this limit, so we can say our anova test will be robust against this unequal variance.

Therefore, we can say that fulfills all the assumptions. 



Recall that the null hypothesis test for an ANOVA test is all the means equal each other, and the alternate hypothesis is that at least one mean is different. After running our ANOVA test, we can see that with significance level $\alpha=.05$, we have which hand you use is significant with a p-value of 0.000369, the interaction between all three is significant with p-value of 0.029744, and the subjects have a significant effect with a p-value of 4.39e-13. However, if we use a Bonferroni adjusted $\alpha$ value, we get $\alpha_{Bonferroni}= \alpha/7 = .05/7 = .0071$, which means that only the hand used and subject (our blocks) are significant.

```{r}
library(knitr)
library(DescTools)

bonferroni_test <- PostHocTest(anova_model, method = c("bonferroni"), conf.level = .05)

kable(
  rbind(bonferroni_test$hand, 
        bonferroni_test$lights,
        bonferroni_test$music, 
        bonferroni_test$subject),
  digits = 4,                   
  caption = "Bonferroni Post-Hoc Test Results",
  align = 'c'
)
```

What this means is that we have evidence that whether or not you use your dominant hand is significant, different people have significant differences, and that we have poor evidence that the 3 way interaction term is significant.
